"use strict";(self.webpackChunkguide_eoscostarica_io=self.webpackChunkguide_eoscostarica_io||[]).push([[2007],{3905:function(e,t,a){a.d(t,{Zo:function(){return u},kt:function(){return h}});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var s=n.createContext({}),c=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},u=function(e){var t=c(e.components);return n.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},p=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),p=c(a),h=r,m=p["".concat(s,".").concat(h)]||p[h]||d[h]||i;return a?n.createElement(m,o(o({ref:t},u),{},{components:a})):n.createElement(m,o({ref:t},u))}));function h(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=a.length,o=new Array(i);o[0]=p;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:r,o[1]=l;for(var c=2;c<i;c++)o[c]=a[c];return n.createElement.apply(null,o)}return n.createElement.apply(null,a)}p.displayName="MDXCreateElement"},4054:function(e,t,a){a.r(t),a.d(t,{assets:function(){return d},contentTitle:function(){return c},default:function(){return m},frontMatter:function(){return s},metadata:function(){return u},toc:function(){return p}});var n=a(7462),r=a(3366),i=(a(7294),a(3905)),o=a(4996),l=["components"],s={id:"demux-pattern",title:"Demux architecture pattern",sidebar_label:"Demux Pattern",description:"Description of demux pattern",keywords:["demux","backend architectural pattern","demux pattern","demux architecture pattern","EOSIO","EOS Costa Rica"]},c=void 0,u={unversionedId:"eos-learn/demux-pattern",id:"eos-learn/demux-pattern",title:"Demux architecture pattern",description:"Description of demux pattern",source:"@site/docs/eos-learn/demux-pattern.md",sourceDirName:"eos-learn",slug:"/eos-learn/demux-pattern",permalink:"/docs/eos-learn/demux-pattern",draft:!1,editUrl:"https://github.com/eoscostarica/guide.eoscostarica.io/tree/master/docs/eos-learn/demux-pattern.md",tags:[],version:"current",frontMatter:{id:"demux-pattern",title:"Demux architecture pattern",sidebar_label:"Demux Pattern",description:"Description of demux pattern",keywords:["demux","backend architectural pattern","demux pattern","demux architecture pattern","EOSIO","EOS Costa Rica"]},sidebar:"docs",previous:{title:"Dapp Development",permalink:"/docs/eos-learn/dapp-development"},next:{title:"EOS Blockchain",permalink:"/docs/eos-learn/eos-blockchain"}},d={},p=[{value:"Demux pattern",id:"demux-pattern",level:2},{value:"Separated Persistence Layer",id:"separated-persistence-layer",level:2},{value:"Single Source of Truth",id:"single-source-of-truth",level:2},{value:"Side Effects",id:"side-effects",level:2},{value:"Data Flow",id:"data-flow",level:2},{value:"Demux Data Flow Diagram",id:"demux-data-flow-diagram",level:3},{value:"Sequence of Demux Data Flow",id:"sequence-of-demux-data-flow",level:3},{value:"Implementation at EOS Costa Rica",id:"implementation-at-eos-costa-rica",level:2},{value:"Open-source projects",id:"open-source-projects",level:3}],h={toc:p};function m(e){var t=e.components,a=(0,r.Z)(e,l);return(0,i.kt)("wrapper",(0,n.Z)({},h,a,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h2",{id:"demux-pattern"},"Demux pattern"),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://medium.com/eosio/introducing-demux-deterministic-databases-off-chain-verified-by-the-eosio-blockchain-bd860c49b017"},"Demux")," is an architectural pattern for backend infrastructure based on ",(0,i.kt)("a",{parentName:"p",href:"https://facebook.github.io/flux/docs/in-depth-overview.html"},"Flux Architecture")," and ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/reduxjs/redux/"},"Redux"),"."),(0,i.kt)("p",null,"It\u2019s used for applications built on the EOSIO blockchain to sourcing to event blockchain events to update queryable datastores and trigger deterministically side effects on the blockchain or external services."),(0,i.kt)("p",null,"Likewise, the pattern in question was born considering the following:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Separate the concern of how the state exists on the blockchain and how the client frontend queries it."),(0,i.kt)("li",{parentName:"ul"},"The client frontend is not the only one responsible for determining the derived, reduced, and/or accumulated state."),(0,i.kt)("li",{parentName:"ul"},"The capacity for blockchain events to trigger new transactions, as well as other side effects outside of the blockchain."),(0,i.kt)("li",{parentName:"ul"},"The blockchain is the single source of truth for all application state. ")),(0,i.kt)("p",null,"In general, demux allows you to get the benefits of blockchain and traditional databases, for one hand, properties such as immutability, traceability, and trust of blockchain, and on the other hand the facility, velocity, and flexibility to query databases. It\u2019s because how to make complex queries on the blockchain has high costs and is taken advantage of thanks to different optimizations of databases the number of resources needed is lower."),(0,i.kt)("h2",{id:"separated-persistence-layer"},"Separated Persistence Layer"),(0,i.kt)("p",null,"The storage of data in an indexed state on the blockchain could be useful for the next three reasons:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"The decentralized consensus of the computational results."),(0,i.kt)("li",{parentName:"ul"},"The use of state within other blockchain computations."),(0,i.kt)("li",{parentName:"ul"},"The retrieve of the state for use in client interfaces.")),(0,i.kt)("p",null,"However, when more complex frontends are built some problems start to appear when directly querying the blockchain, is because of this that demux addresses the scaling problem by off-loading queries to any persistence layer that is defined according to the needs, for this reason, the data are preprocessed and indexed in a traditional database."),(0,i.kt)("p",null,"This avoids adding more endpoints nodes when you need to scale the load of queries and also omits having to perform an excessive number of queries to the blockchain and process the extremely costly data. The previous is useful when complex applications need to retrieve data from the blockchain."),(0,i.kt)("p",null,"Thus, as the blockchain events are produced, the chosen database is updated by update functions (",(0,i.kt)("inlineCode",{parentName:"p"},"Updaters"),") that deterministically process the ",(0,i.kt)("inlineCode",{parentName:"p"},"Actions")," object array. Then, the database is kept updated concerning the blockchain state and the DAPP frontend queries the database through the appropriate ",(0,i.kt)("inlineCode",{parentName:"p"},"API"),"."),(0,i.kt)("h2",{id:"single-source-of-truth"},"Single Source of Truth"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"If the database is deleted or lost it can be recovered by reproducing the actions of the blockchain."),(0,i.kt)("li",{parentName:"ul"},"If the application is open-source and the blockchain is public, the state of the application could be audited. "),(0,i.kt)("li",{parentName:"ul"},"It\u2019s not necessary to keep multiple ways of updating the state.")),(0,i.kt)("h2",{id:"side-effects"},"Side Effects"),(0,i.kt)("p",null,"Since you have a system for acting on specific blockchain events deterministically, you can use this system to handle non-deterministic events as well. "),(0,i.kt)("p",null,"These effect functions (",(0,i.kt)("inlineCode",{parentName:"p"},"Effects"),") work almost the same as update functions, except that they run asynchronously, do not run during replays, and modification of the deterministic data store is out of bounds. "),(0,i.kt)("p",null,"Some examples of side effects are:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Signing and broadcasting a transaction."),(0,i.kt)("li",{parentName:"ul"},"Sending an email."),(0,i.kt)("li",{parentName:"ul"},"Begin a traditional fiat payment.")),(0,i.kt)("h2",{id:"data-flow"},"Data Flow"),(0,i.kt)("p",null,"Like ",(0,i.kt)("a",{parentName:"p",href:"https://facebook.github.io/flux/docs/in-depth-overview.html#structure-and-data-flow"},"Flux")," and ",(0,i.kt)("a",{parentName:"p",href:"https://redux.js.org/tutorials/essentials/part-1-overview-concepts#redux-terms-and-concepts"},"Redux"),", the data flow in demux is unidirectional. Starting from the DAPP frontend, it can write to the data string through ",(0,i.kt)("inlineCode",{parentName:"p"},"Transactions"),", which will be read by an observer (",(0,i.kt)("inlineCode",{parentName:"p"},"Action Watcher"),") to notify that they should be handled which can cause side effects, after that through the update functions the event will be recorded in the database which will be queried through an ",(0,i.kt)("inlineCode",{parentName:"p"},"API")," by the DAPP."),(0,i.kt)("h3",{id:"demux-data-flow-diagram"},"Demux Data Flow Diagram"),(0,i.kt)("div",{style:{textAlign:"center"}},(0,i.kt)("img",{alt:"Demux Data Flow Diagram",title:"Demux Patern Diagram",src:(0,o.Z)("/img/diagrams/demux-pattern.webp"),loading:"lazy"})),(0,i.kt)("h3",{id:"sequence-of-demux-data-flow"},"Sequence of Demux Data Flow"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"The client sends a transaction to the blockchain."),(0,i.kt)("li",{parentName:"ol"},"The ",(0,i.kt)("inlineCode",{parentName:"li"},"Action Watcher")," invokes ",(0,i.kt)("inlineCode",{parentName:"li"},"Action Reader")," to check for new blocks."),(0,i.kt)("li",{parentName:"ol"},"The ",(0,i.kt)("inlineCode",{parentName:"li"},"Action Reader")," sees transactions in the new block and parses actions."),(0,i.kt)("li",{parentName:"ol"},"The ",(0,i.kt)("inlineCode",{parentName:"li"},"Action Watcher")," sends actions to ",(0,i.kt)("inlineCode",{parentName:"li"},"Action Handler"),"."),(0,i.kt)("li",{parentName:"ol"},"The ",(0,i.kt)("inlineCode",{parentName:"li"},"Action Handler")," processes actions through ",(0,i.kt)("inlineCode",{parentName:"li"},"Updaters")," and ",(0,i.kt)("inlineCode",{parentName:"li"},"Effects"),"."),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"Actions")," run their corresponding ",(0,i.kt)("inlineCode",{parentName:"li"},"Updaters"),", updating the state of the Datastore."),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"Actions")," run their corresponding ",(0,i.kt)("inlineCode",{parentName:"li"},"Effects"),", triggering external events."),(0,i.kt)("li",{parentName:"ol"},"The client queries ",(0,i.kt)("inlineCode",{parentName:"li"},"API")," for updated data.")),(0,i.kt)("h2",{id:"implementation-at-eos-costa-rica"},"Implementation at EOS Costa Rica"),(0,i.kt)("p",null,"We use our solution inspired by the demux architectural pattern, which use the nodeos State History Plugin as ",(0,i.kt)("inlineCode",{parentName:"p"},"Action Watcher"),"."),(0,i.kt)("h3",{id:"open-source-projects"},"Open-source projects"),(0,i.kt)("p",null,"Some of our open source projects implemented the solution based on the demux pattern:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://github.com/eoscostarica/eosio-dashboard"},"EOSIO Dashboard")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://github.com/eoscostarica/MyvoteEOS-proxy"},"MyvoteEOS")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://github.com/eoscostarica/eosio-spend-explorer"},"EOSIO Spend Explorer"))))}m.isMDXComponent=!0}}]);